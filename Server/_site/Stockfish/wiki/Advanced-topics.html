<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> | Chess </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" | Chess ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Moosdorf/Chess-Website-FULLSTACK/blob/main/Server/Stockfish/wiki/Advanced-topics.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Chess">
            Chess
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<h2 id="syzygy-tablebases">Syzygy tablebases</h2>
<p>If the engine is searching a position that is not in the tablebases (e.g. a position with 8 pieces), it will access the tablebases (TB) during the search. If the engine reports a very large score (near 200.00), it means that it has found a winning line into a tablebase position. For general play, tablebases bring only a limited increase in strength (see <a href="Useful-data#elo-gain-using-syzygy">our Elo measurements</a>).</p>
<p>When the engine is given a position to search that is in the tablebases, it will use the tablebases at the beginning of the search to preselect all good moves, i.e. all moves that preserve the win or preserve the draw while taking into account the 50-move rule. It will then perform a search only on those moves. The engine <strong>will not move immediately</strong>, unless there is only a single good move. The engine <strong>will search for the shortest possible mate</strong>, even though the position is known to be won.</p>
<p>It is therefore clear that this behavior is not identical to what one might be used to with Nalimov tablebases. There are technical reasons for this difference, the main technical reason being that Nalimov tablebases use the DTM metric (distance-to-mate), while the Syzygy tablebases use a variation of the DTZ metric (distance-to-zero, zero meaning any move that resets the 50-move counter). This special metric is one of the reasons that the Syzygy tablebases are more compact than Nalimov tablebases, while still storing all the information needed for optimal play and in addition being able to take into account the 50-move rule.</p>
<p>The use of 7-piece tablebases is possible with Stockfish and requires around 17TB of storage. Furthermore, the system must allow a single process to open all 1511 files, which sometimes requires increasing the default limit (e.g. <code>ulimit -n</code>).</p>
<hr>
<h2 id="large-pages">Large Pages</h2>
<p>Stockfish supports large pages on Linux and Windows. Large pages make the hash access more efficient, improving the engine speed, especially on large hash sizes.<br>
The support is automatic, Stockfish attempts to use large pages when available and will fall back to regular memory allocation when this is not the case.<br>
Typical increases are 5-10% in terms of nodes per second, but speed increases up to 30% have been measured.</p>
<h3 id="linux">Linux</h3>
<p>Large page support on Linux is obtained by the Linux kernel transparent huge pages functionality. Typically, transparent huge pages are already enabled, and no configuration is needed.</p>
<h3 id="windows">Windows</h3>
<p>The use of large pages requires &quot;Lock Pages in Memory&quot; privilege. See <a href="https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows">Enable the Lock Pages in Memory Option (Windows)</a> on how to enable this privilege, then run <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/rammap">RAMMap</a> to double-check that large pages are used.<br>
We suggest that you reboot your computer after you have enabled large pages, because long Windows sessions suffer from memory fragmentation, which may prevent Stockfish from getting large pages: a fresh session is better in this regard.</p>
<hr>
<h2 id="measure-the-speed-of-stockfish">Measure the speed of Stockfish</h2>
<p>The &quot;speed of Stockfish&quot; is the number of nodes (positions) Stockfish can search per second.
Nodes per second (nps) is a useful benchmark number as the same version of Stockfish playing will play stronger with larger nps.
Different versions of Stockfish will play at different nps, for example, if the NNUE network architecture changes, but in this case the nps difference is not related to the strength difference.</p>
<div class="NOTE">
<h5>Note</h5>
<ul>
<li>Stop all other applications when measuring the speedup of Stockfish</li>
<li>Run at least 20 default benches (depth 13) for each build of Stockfish to have accurate measures</li>
<li>A speedup of 0.3% could be meaningless (i.e. within the measurement noise)</li>
</ul>
</div>
<p>To measure the speed of several builds of Stockfish, use one of these applications:</p>
<ul>
<li><p>All OS:</p>
<ul>
<li><p><a href="https://github.com/hazzl/pyshbench">pyshbench</a>: Latest release <a href="https://github.com/hazzl/pyshbench/archive/master.zip">pyshbench</a></p>
</li>
<li><p>bash script <code>bench_parallel.sh</code> (run <code>bash bench_parallel.sh</code> for the help)<br>
it might be that you have to install gawk as well on your system to not get syntax errors.</p>
<details><summary>Click to view</summary>
<pre><code class="lang-bash">#!/bin/bash
_bench () {
${1} &lt;&lt; EOF &gt; /dev/null 2&gt;&gt; ${2}
bench 16 1 ${depth} default depth
EOF
}
# _bench function customization example
# setoption name SyzygyPath value C:\table_bases\wdl345;C:\table_bases\dtz345
# bench 128 4 ${depth} default depth

if [[ ${#} -ne 4 ]]; then
cat &lt;&lt; EOF
usage: ${0} ./stockfish_base ./stockfish_test depth n_runs
fast bench:
${0} ./stockfish_base ./stockfish_test 13 10
slow bench:
${0} ./stockfish_base ./stockfish_test 20 10
EOF
exit 1
fi

sf_base=${1}
sf_test=${2}
depth=${3}
n_runs=${4}

# preload of CPU/cache/memory
printf &quot;preload CPU&quot;
(_bench ${sf_base} sf_base0.txt)&amp;
(_bench ${sf_test} sf_test0.txt)&amp;
wait

# temporary files initialization
: &gt; sf_base0.txt
: &gt; sf_test0.txt
: &gt; sf_temp0.txt

# bench loop: SMP bench with background subshells
for ((k=1; k&lt;=${n_runs}; k++)); do
    printf &quot;\rrun %3d /%3d&quot; ${k} ${n_runs}

    # swap the execution order to avoid bias
    if [ $((k%2)) -eq 0 ]; then
        (_bench ${sf_base} sf_base0.txt)&amp;
        (_bench ${sf_test} sf_test0.txt)&amp;
        wait
    else
        (_bench ${sf_test} sf_test0.txt)&amp;
        (_bench ${sf_base} sf_base0.txt)&amp;
        wait
    fi
done

# text processing to extract nps values
cat sf_base0.txt | grep second | grep -Eo '[0-9]{1,}' &gt; sf_base1.txt
cat sf_test0.txt | grep second | grep -Eo '[0-9]{1,}' &gt; sf_test1.txt

for ((k=1; k&lt;=${n_runs}; k++)); do
    echo ${k} &gt;&gt; sf_temp0.txt
done

printf &quot;\rrun   sf_base   sf_test      diff\n&quot;
paste sf_temp0.txt sf_base1.txt sf_test1.txt | awk '{printf &quot;%3d  %8d  %8d  %8+d\n&quot;, $1, $2, $3, $3-$2}'
#paste sf_temp0.txt sf_base1.txt sf_test1.txt | awk '{printf &quot;%3d\t%8d\t%8d\t%7+d\n&quot;, $1, $2, $3, $3-$2}'
paste sf_base1.txt sf_test1.txt | awk '{printf &quot;%d\t%d\t%d\n&quot;, $1, $2, $2-$1}' &gt; sf_temp0.txt

# compute: sample mean, 1.96 * std of sample mean (95% of samples), speedup
# std of sample mean = sqrt(NR/(NR-1)) * (std population) / sqrt(NR)
cat sf_temp0.txt | awk '{sum1 += $1 ; sumq1 += $1**2 ;sum2 += $2 ; sumq2 += $2**2 ;sum3 += $3 ; sumq3 += $3**2 } END {printf &quot;\nsf_base = %8d +/- %6d (95%)\nsf_test = %8d +/- %6d (95%)\ndiff    = %8d +/- %6d (95%)\nspeedup = %.5f% +/- %.3f% (95%)\n\n&quot;, sum1/NR , 1.96 * sqrt(sumq1/NR - (sum1/NR)**2)/sqrt(NR-1) , sum2/NR , 1.96 * sqrt(sumq2/NR - (sum2/NR)**2)/sqrt(NR-1) , sum3/NR  , 1.96 * sqrt(sumq3/NR - (sum3/NR)**2)/sqrt(NR-1) , 100*(sum2 - sum1)/sum1 , 100 * (1.96 * sqrt(sumq3/NR - (sum3/NR)**2)/sqrt(NR-1)) / (sum1/NR) }'

# remove temporary files
rm -f sf_base0.txt sf_test0.txt sf_temp0.txt sf_base1.txt sf_test1.txt
</code></pre>
</details>
<details><summary>Bench two git branches with bench_parallel</summary>
<pre><code class="lang-bash">#!/bin/bash

if [ &quot;$#&quot; -ne 5 ]; then
echo &quot;Usage: $0 branch1 branch2 depth runs compile_flags&quot;
exit 1
fi

BRANCH1=$1
BRANCH2=$2
DEPTH=$3
RUNS=$4
COMPILE_FLAGS=$5

set -e

echo &quot;Switching to $BRANCH1 and building...&quot;
git switch $BRANCH1
make clean
make -j profile-build EXE=stockfish-$BRANCH1 $COMPILE_FLAGS

echo &quot;Switching to $BRANCH2 and building...&quot;
git switch $BRANCH2
make clean
make -j profile-build EXE=stockfish-$BRANCH2 $COMPILE_FLAGS

echo &quot;Running bench_parallel.sh with stockfish-$BRANCH1 and stockfish-$BRANCH2...&quot;
./bench_parallel.sh ./stockfish-$BRANCH1 ./stockfish-$BRANCH2 $DEPTH $RUNS
</code></pre>
</details>
</li>
<li><p><a href="UCI-&amp;-Commands#speedtest"><code>speedtest</code></a> command</p>
</li>
</ul>
</li>
<li><p>Windows only:</p>
<ul>
<li><a href="https://github.com/zardav/FishBench">FishBench</a>: Latest release <a href="https://github.com/zardav/FishBench/releases/download/v6.0/FishBench.zip">Fishbench v6.0</a></li>
<li><a href="http://software.farseer.org/">Buildtester</a>: Latest release <a href="http://software.farseer.org/Software/BuildTester.7z">Buildtester 1.4.7.0</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="cluster-version">Cluster version</h2>
<p>There is a branch developed with a MPI cluster implementation of Stockfish, allowing stockfish to run on clusters of compute nodes connected with a high-speed network. See <a href="https://github.com/official-stockfish/Stockfish/pull/1571">https://github.com/official-stockfish/Stockfish/pull/1571</a> for some discussion of the initial implementation and <a href="https://github.com/official-stockfish/Stockfish/pull/1931">https://github.com/official-stockfish/Stockfish/pull/1931</a> for some early performance results.</p>
<p>Feedback on this branch is welcome! Here are some git commands for people interested to test this MPI/Cluster idea:</p>
<ol>
<li><p>If you don't have the cluster branch yet on your local git repository, you can download the latest state of the <a href="https://github.com/official-stockfish/Stockfish/tree/cluster"><code>official-stockfish/cluster</code></a> branch, then switch to it with the following commands:</p>
<pre><code class="lang-bash">git fetch official cluster:cluster
git checkout -f cluster
</code></pre>
</li>
<li><p>After switching to the cluster branch as above, see the README.md for detailed instructions on how to compile and run the branch. TL;DR:</p>
<pre><code class="lang-bash">make clean
make -j ARCH=x86-64-avx2 COMPCXX=mpic++ build
mpirun -np 4 ./stockfish bench
</code></pre>
</li>
</ol>
<hr>
<h2 id="classical-versus-nnue-evaluation">Classical versus NNUE evaluation</h2>
<p>Current versions of Stockfish use a strong neural network (NNUE) to evaluate positions. The venerable &quot;Classical&quot; evaluation, which was about 250 Elo points weaker, was removed from the codebase in August 2023.</p>
<p>Both approaches assign a value to a position that is used in alpha-beta (PVS) search to find the best move. The classical evaluation computed this value as a function of various chess concepts, handcrafted by experts, tested and tuned using fishtest. The NNUE evaluation computes this value with a neural network based on basic inputs (e.g. piece positions only). The network is optimized and trained on the evaluations of millions of positions at moderate search depth.</p>
<p>The NNUE evaluation was first introduced in shogi, and ported to Stockfish afterward. It can be evaluated efficiently on CPUs, and exploits the fact that only parts of the neural network need to be updated after a typical chess move. <a href="https://github.com/nodchip/Stockfish">The nodchip repository</a> provided the first version of the needed tools to train and develop the NNUE networks. Today, more advanced training tools are available in <a href="https://github.com/official-stockfish/nnue-pytorch">the nnue-pytorch repository</a>, while data generation tools are available in <a href="https://github.com/official-stockfish/Stockfish/tree/tools">a dedicated branch</a>.</p>
<p>On CPUs supporting modern vector instructions (avx2 and similar), the NNUE evaluation results in much stronger playing strength, even if the nodes per second computed by the engine is somewhat lower (roughly 50% of nps is typical).</p>
<div class="NOTE">
<h5>Note</h5>
<ol>
<li>The NNUE evaluation depends on the Stockfish binary and the network parameter file (see the <code>EvalFile</code> UCI option). Not every parameter file is compatible with a given Stockfish binary, but the default value of the EvalFile UCI option is the name of a network that is guaranteed to be compatible with that binary.</li>
<li>To use the NNUE evaluation, the additional data file with neural network parameters needs to be available. Normally, this file is already embedded in the binary or it can be downloaded. The filename for the default (recommended) net can be found as the default value of the <code>EvalFile</code> UCI option, with the format <code>nn-[SHA256 first 12 digits].nnue</code> (for instance, <code>nn-c157e0a5755b.nnue</code>). This file can be downloaded from <code>https://tests.stockfishchess.org/api/nn/[filename]</code> replacing <code>[filename]</code> as needed.</li>
</ol>
</div>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Moosdorf/Chess-Website-FULLSTACK/blob/main/Server/Stockfish/wiki/Advanced-topics.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
